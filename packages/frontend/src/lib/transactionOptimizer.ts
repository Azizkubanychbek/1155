/**
 * –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –∫–æ–º–∏—Å—Å–∏–∏
 * 
 * –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:
 * 1. Batch –æ–ø–µ—Ä–∞—Ü–∏–∏ –∫–æ–≥–¥–∞ –≤–æ–∑–º–æ–∂–Ω–æ
 * 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö calldata
 * 3. –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ gas limit
 */

// –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è zkSync
export const OPTIMIZED_GAS_CONFIG = {
  // zkSync –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç gas
  // –ù–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ª–∏–º–∏—Ç—ã –≤—Ä—É—á–Ω—É—é
  
  // –î–ª—è batch –æ–ø–µ—Ä–∞—Ü–∏–π
  batchGasMultiplier: 0.9, // –≠–∫–æ–Ω–æ–º–∏—è 10% –ø—Ä–∏ batch
};

/**
 * –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–∂–Ω–æ –ª–∏ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ batch
 */
export function canBatchOperations(operations: any[]): boolean {
  // –ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–ø–µ—Ä–∞—Ü–∏–π —Å –æ–¥–Ω–∏–º –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–º - –º–æ–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å
  return operations.length > 1;
}

/**
 * –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
 */
export function optimizeTransaction(tx: any) {
  // –£–¥–∞–ª—è–µ–º –ª–∏—à–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ—Ç–æ—Ä—ã–µ —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç calldata
  const optimized = { ...tx };
  
  // zkSync –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç —Å–∞–º, –Ω–µ –Ω—É–∂–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å:
  delete optimized.gasLimit;
  delete optimized.maxFeePerGas;
  delete optimized.maxPriorityFeePerGas;
  
  return optimized;
}

/**
 * –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Å–Ω–∏–∂–µ–Ω–∏—é –∫–æ–º–∏—Å—Å–∏–∏
 */
export const GAS_OPTIMIZATION_TIPS = {
  deposit: {
    tip: "–î–µ–ø–æ–∑–∏—Ç –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ",
    savings: "–î–æ 30% —ç–∫–æ–Ω–æ–º–∏–∏",
  },
  grant: {
    tip: "–í—ã–¥–∞–≤–∞–π—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –∑–∞ –æ–¥–Ω—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é",
    savings: "–î–æ 40% —ç–∫–æ–Ω–æ–º–∏–∏",
  },
  craft: {
    tip: "–ö—Ä–∞—Ñ—Ç–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –∫–æ–≥–¥–∞ –≤–æ–∑–º–æ–∂–Ω–æ",
    savings: "–î–æ 25% —ç–∫–æ–Ω–æ–º–∏–∏",
  },
};

/**
 * –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å–æ–≤–µ—Ç –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
 */
export function showOptimizationTip(operation: string) {
  const tip = GAS_OPTIMIZATION_TIPS[operation as keyof typeof GAS_OPTIMIZATION_TIPS];
  if (tip) {
    console.log(`üí° –°–æ–≤–µ—Ç –ø–æ —ç–∫–æ–Ω–æ–º–∏–∏ –≥–∞–∑–∞: ${tip.tip} (${tip.savings})`);
  }
}

